function CFG = HueScaling_CFG_gui()
    % CFG = HueScaling_CFG_gui()
    %
    % Get experimental parameters (CFG).
    
    import AOSLO_experiments.*
    
    CFG = AOSLO_experiments.HueScaling_CFG_load();

    %  Construct the components
    
    % ---- Figure handle
    f = figure('Visible','on','Name','parameters',...
            'Position',[500, 500, 475, 325], 'Toolbar', 'none');
    
    % ---- Panel
    ph = uipanel('Parent',f, 'Title', 'Experiment parameters',...
            'Position',[.05 .05 .9 .9]);

    % ---- Text boxes
    uicontrol(ph,'Style','text',...
                'String','Subject ID',...
                'Units','normalized',...
                'Position',[.05 .9 .25 .10]);
            
    initials = uicontrol(ph,'Style','edit',...
            'Units','normalized',...
            'String', CFG.initials,...
            'Position', [.05 .85 .25 .10]);

    uicontrol(ph,'Style','text',...
                'String','pupil size (mm)',...
                'Units','normalized',...
                'Position', [.05 .75 .25 .10]);
            
    pupilsize = uicontrol(ph,'Style','edit',...
            'Units','normalized',...
            'String', num2str(CFG.pupilsize),...
            'Position', [.05 .7 .25 .10]); 
        
    uicontrol(ph,'Style','text',...
                'String','fieldsize (deg)',...
                'Units','normalized',...
                'Position',[.05 .6 .25 .10]);
            
    fieldsize = uicontrol(ph,'Style','edit',...
            'Units','normalized',...
            'String', num2str(CFG.fieldsize),...
            'Position', [.05 .55 .25 .10]);
        
    uicontrol(ph,'Style','text',...
                'String','stim size (pix)',...
                'Units','normalized',...
                'Position',[.35 .9 .25 .10]);
            
    stimsize = uicontrol(ph,'Style','edit',...
            'Units','normalized',...
            'String', num2str(CFG.stimsize),...
            'Position', [.35 .85 .25 .10]); 

    uicontrol(ph,'Style','text',...
                'String','flash dur (msec)',...
                'Units','normalized',...
                'Position',[.35 .75 .25 .10]);
            
    presentdur = uicontrol(ph,'Style','edit',...
            'Units','normalized',...
            'String', num2str(CFG.presentdur),...
            'Position', [.35 .7 .25 .10]); 

    uicontrol(ph,'Style','text',...
                'String','# trials',...
                'Units','normalized',...
                'Position',[.35 .6 .25 .10]);
            
    ntrials = uicontrol(ph,'Style','edit',...
            'Units','normalized',...
            'String', num2str(CFG.ntrials),...
            'Position', [.35 .55 .25 .10]); 

        
    uicontrol(ph,'Style','text',...
                'String','tracking gain',...
                'Units','normalized',...
                'Position',[.65 .9 .275 .10]); 
            
    gain = uicontrol(ph,'Style','edit',...
            'Units','normalized',...
            'String', num2str(CFG.gain),...
            'Position', [.65 .85 .275 .10]);%, ...
            %'Enable', 'Inactive', ...
            %'ButtonDownFcn', @get_cal_file);
            
    uicontrol(ph,'Style','text',...
                'String','N scale',...
                'Units','normalized',...
                'Position',[.65 .75 .275 .10]);
            
    nscale = uicontrol(ph,'Style','edit',...
            'Units','normalized',...
            'String', num2str(5),...
            'Position', [.65 .7 .275 .10]); 
        
    uicontrol(ph,'Style','text',...
                'String','system: aoslo, tslo, etc',...
                'Units','normalized',...
                'Position',[.65 .6 .275 .10]);
            
    system = uicontrol(ph,'Style','edit',...
            'Units','normalized',...
            'String', CFG.system,...
            'Position', [.65 .55 .275 .10]);
        
        
    % ---- Radio buttons
    uicontrol(ph,'Style','text',...
            'String','stim shape',...
            'Units','normalized',...
            'Position',[.35 .45 .25 .07]);  
        
    stimshape = uibuttongroup(ph, 'Units','Normalized', ...
        'Position', [.35 .3 .25 .15]);
    
    b1 = uicontrol('Style','Radio', 'Parent', stimshape, ...
        'HandleVisibility','off', ...
        'Units','Normalized', ...
        'Position', [.1 .6 .8 .35], ...
        'String','square', 'Tag','square');

    b2 = uicontrol('Style','Radio', 'Parent', stimshape, ...
        'HandleVisibility','off', ...
        'Units','Normalized', ...
        'Position',  [.1 .1 .8 .35], ...
        'String','circle', 'Tag','circle');
    
    uicontrol(ph,'Style','text',...
                'String','cone selection',...
                'Units','normalized',...
                'Position',[.05 .45 .25 .07]);
    % set the default selected button.
    if strcmpi(CFG.stimshape, 'square')
        set(stimshape,'SelectedObject', b1);  % Set the object
    else
        set(stimshape,'SelectedObject', b2);  % Set the object
    end
    
    uicontrol(ph,'Style','text',...
            'String','random flicker',...
            'Units','normalized',...
            'Position',[.05 .2 .25 .07]);  
        
    random_flicker = uibuttongroup(ph, 'Units','Normalized', ...
        'Position', [.05 .05 .25 .15]);
    
    b1 = uicontrol('Style','Radio', 'Parent', random_flicker, ...
        'HandleVisibility','off', ...
        'Units','Normalized', ...
        'Position', [.1 .6 .8 .35], ...
        'String','false', 'Tag','0');

    b2 = uicontrol('Style','Radio', 'Parent', random_flicker, ...
        'HandleVisibility','off', ...
        'Units','Normalized', ...
        'Position',  [.1 .1 .8 .35], ...
        'String','true', 'Tag','1');
    
    uicontrol(ph,'Style','text',...
                'String','cone selection',...
                'Units','normalized',...
                'Position',[.05 .45 .25 .07]);
            
    % set the default selected button.
    if CFG.random_flicker
        set(random_flicker, 'SelectedObject', b2);  % Set the object
    else
        set(random_flicker, 'SelectedObject', b1);  % Set the object
    end
            
    
    cone_selection = uibuttongroup(ph, 'Units','Normalized', ...
        'Position', [.05 .3 .25 .15]);
    
    b1 = uicontrol('Style','Radio', 'Parent', cone_selection, ...
        'HandleVisibility','off', ...
        'Units','Normalized', ...
        'Position', [.1 .6 .8 .35], ...
        'String','auto', 'Tag', 'auto');
    
    b2 = uicontrol('Style','Radio', 'Parent', cone_selection, ...
        'HandleVisibility','off', ...
        'Units','Normalized', ...
        'Position',  [.1 .1 .8 .35], ...
        'String','manual', 'Tag', 'manual');
    
    % set the default selected button.
    if strcmpi(CFG.cone_selection, 'auto')
        set(cone_selection,'SelectedObject', b1);  % Set the object
    else
        set(cone_selection,'SelectedObject', b2);  % Set the object
    end
            
    % ---- TCA Panel
    
    tcapanel = uipanel('Parent',f, 'Title', 'TCA',...
            'Position',[.635 .2 .25 .3]);
        
    
    uicontrol(tcapanel,'Style','text',...
                'String','X',...
                'Units','normalized',...
                'Position', [.4 .85 .1 .15]);
            
    uicontrol(tcapanel,'Style','text',...
                'String','Y',...
                'Units','normalized',...
                'Position', [.68 .85 .1 .15]);
            
    uicontrol(tcapanel,'Style','text',...
                'String','red',...
                'Units','normalized',...
                'Position', [.02 .6 .25 .15]); 
            
    uicontrol(tcapanel,'Style','text',...
                'String','green',...
                'Units','normalized',...
                'Position', [.02 .2 .25 .15]);  
            
    red_x_offset = uicontrol(tcapanel,'Style','edit',...
                'Units','normalized',...
                'enable', 'off', ...
                'String', CFG.red_x_offset,...
                'Position', [.3 .5 .3 .3]);

    red_y_offset = uicontrol(tcapanel,'Style','edit',...
                'Units','normalized',...
                'enable', 'off', ...
                'String', CFG.red_y_offset,...
                'Position', [.6 .5 .3 .3]);
            

    green_x_offset = uicontrol(tcapanel,'Style','edit',...
                'Units','normalized',...
                'String', CFG.green_x_offset,...
                'Position', [.3 .1 .3 .3]);

    green_y_offset = uicontrol(tcapanel,'Style','edit',...
                'Units','normalized',...
                'String', CFG.green_y_offset,...
                'Position', [.6 .1 .3 .3]);
            
    % ---- Buttons
    uicontrol(ph,'Style','pushbutton','String','start',...
            'Units','normalized',...
            'Position', [.35 .05 .25 .12], ...
            'Callback', 'uiresume(gcbf)');

%     uicontrol(ph,'Style','pushbutton','String','plot stimuli',...
%             'Units','normalized',...
%             'Position', [.05 .05 .25 .15], ...
%             'Callback', @plot_stimuli);
        
    uiwait(f);
    
    get_current_CFG();
    
    function get_current_CFG()
        CFG.initials = get(initials, 'String');
        CFG.stimshape = get(get(stimshape, 'SelectedObject'), 'Tag');
        CFG.cone_selection = get(get(cone_selection, 'SelectedObject'), 'Tag');
        CFG.random_flicker = str2double(get(get(random_flicker, ...
            'SelectedObject'), 'Tag'));
        CFG.fieldsize = str2double(get(fieldsize, 'String'));
        CFG.presentdur = str2double(get(presentdur, 'String'));
        CFG.pupilsize = str2double(get(pupilsize, 'String'));
        CFG.ntrials = str2double(get(ntrials, 'String'));
        CFG.nscale = str2double(get(nscale, 'String'));
        CFG.gain = str2double(get(gain, 'String'));
        CFG.stimsize = str2double(get(stimsize, 'String'));
        
        CFG.red_x_offset = str2double(get(red_x_offset, 'String'));
        CFG.red_y_offset = str2double(get(red_y_offset, 'String'));
        CFG.green_x_offset = str2double(get(green_x_offset, 'String'));
        CFG.green_y_offset = str2double(get(green_y_offset, 'String'));
        
        CFG.system = get(system, 'String');
        
    end

    close(f);

end